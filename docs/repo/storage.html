<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  
  <title>Storage Back-ends &mdash; GeoGig 1.2 User Manual</title>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,800italic,300,700,600,800,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cantarell:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="../_static/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="../_static/print.css" type="text/css" media="print" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="../_static/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/offcanvas.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
      <link rel="index" title="Index" href="../genindex.html" />
      <link rel="search" title="Search" href="../search.html" />
      <link rel="top" title="GeoGig 1.2 User Manual" href="../index.html" />
      <link rel="up" title="Working with repositories" href="index.html" />
      <link rel="next" title="Initializing a repository" href="init.html" />
      <link rel="prev" title="Repository elements" href="elements.html" />
</head>
<body class="repo/storage">
    <div id="blacktop"></div>
    <header id="masthead">
      <div class="navbar">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://geogig.org"><h1>GeoGig</h1></a>
          </div>
          <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
              <li><a href="http://geogig.org/#install">Get Started</a></li>
              <li><a href="http://geogig.org/docs/index.html">Documentation</a></li>
              <li><a href="https://github.com/locationtech/geogig">On Github</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </div>
    </header>

    <section class="subheading hidden-xs">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <p class="byline">A Tool for Geospatial Data Management</p>
          </div>
        </div>
      </div>
    </section>
    <a name="top"></a>

 <div id="main">
    <div class="wrap selfclear">
      <div id="content">
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
          <div class="col-md-8">
            <div class="row pull-right">
             <div class="visible-sm visible-xs" id="menu-btn">
                <button class="btn btn-blue btn-sm"type="button" data-toggle="offcanvas">
                  <span class="btn-text active">Menu &rarr;</span>
                  <span class="btn-back">&larr; Back</span>
                </button>
              </div>
            </div>
<ul id="breadcrumbs">
  
  <li><a href="../index.html">GeoGig 1.2 User Manual</a> &raquo;</li>
  <li><a href="index.html" accesskey="U">Working with repositories</a> &raquo;</li>
  <li>Storage Back-ends</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="../genindex.html" title="General Index"
       accesskey="I">index</a></li>
  <li>
    <a href="init.html" title="Initializing a repository"
       accesskey="N">next</a>|</li>
  <li>
    <a href="elements.html" title="Repository elements"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="storage-back-ends">
<span id="repo-storage"></span><h1>Storage Back-ends<a class="headerlink" href="#storage-back-ends" title="Permalink to this headline">¶</a></h1>
<p>GeoGig can store repository elements in different storage backends or databases.</p>
<p>There are currently two storage backends: one default backend for repositories in the local computer’s file system, and the second is a PostgreSQL backend that stores all the repository data in a Postgres database.</p>
<p>Whether to use one or the other is a matter of choice and/or convenience. The default storage backend is recommended for single repositories, such as when you are working on a specific project in your local machine.</p>
<p>The PostgreSQL backend is recommended for server side deployments, such as a deployment where several repositories are served through GeoServer.</p>
<p>A common scenario is to have a remote GeoServer with several repositories that use the PostgreSQL backend to host them all, and a local clone of one of those repositories in your local machine, can take the local clone off-line or simply do work disconnected from the server, and then pull from and push changes to the remote repository.</p>
</div>
<div class="section" id="default-storage-backend">
<h1>Default storage backend<a class="headerlink" href="#default-storage-backend" title="Permalink to this headline">¶</a></h1>
<p>Up to 1.0-RC3, the default storage backend was a BerkeleyDB Java Edition key/value database for the main repository elements such as the revision and graph objects, and simple text files for configuration settings, refs, and merge conflicts.</p>
<p>As of 1.0-RC4, the BerkeleyDB database was replaced by a better performing database, RocksDB. Nonetheless, repositories created with the BerkeleyDB storage backend will still be supported through GeoGig’s plug-in mechanism.</p>
<p>When a repository is created in the local filesystem, it uses a directory structure like the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@localhost:/data/myrepository$</span> ls .geogig/ -F1
<span class="go">config</span>
<span class="go">graph/</span>
<span class="go">HEAD</span>
<span class="go">hooks/</span>
<span class="go">log/</span>
<span class="go">objects/</span>
<span class="go">refs/</span>
<span class="go">STAGE_HEAD</span>
<span class="go">WORK_HEAD</span>
</pre></div>
</div>
<p>In order to use the GeoGig command line for a specific local repository, you can either:</p>
<ul class="simple">
<li>Work inside the repository directory (the <code class="docutils literal notranslate"><span class="pre">.geogig</span></code> directory’s parent), like in the example above;</li>
<li>Use the <code class="docutils literal notranslate"><span class="pre">--repo</span> <span class="pre">&lt;path/to/repository&gt;</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">geogig</span></code> command. e.g.: <code class="docutils literal notranslate"><span class="pre">user&#64;localhost:/home/user$</span> <span class="pre">geogig</span> <span class="pre">--repo</span> <span class="pre">/data/myrepository</span> <span class="pre">log</span></code> to list the commits in the current branch of the <code class="docutils literal notranslate"><span class="pre">/data/myrepository</span></code> repo.</li>
</ul>
</div>
<div class="section" id="postgresql-storage-backend">
<h1>PostgreSQL storage backend<a class="headerlink" href="#postgresql-storage-backend" title="Permalink to this headline">¶</a></h1>
<p>Whilst the default storage backend can hold only one single repository per directory, the PostgreSQL storage backend is designed to host several repositories in the same database.</p>
<p>It stores everything that’s needed in the database, making it “stateless” and hence the best choice for server deployments, since you can even have several GeoServer instances serving data from the same repositories, in a cluster-like deployment.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The database DOES NOT need PostGIS. A plain PostgreSQL database is used as a pure key/value store for most needs. Beware that for performance reasons, PostgreSQL 9.4 or newer is recommended, since prior versions have a performance issue with hash indexing that has been fixed since.</p>
</div>
<div class="section" id="postgresql-repository-uri">
<h2>PostgreSQL repository URI<a class="headerlink" href="#postgresql-repository-uri" title="Permalink to this headline">¶</a></h2>
<p>Since a repository stored in PostgreSQL is stateless, as far as the local machine is concerned, you need to specify the repository location for every console command you want to execute against it.</p>
<p>This is done through a URI (Universal Resource Identifier) of the following form:</p>
<p><code class="docutils literal notranslate"><span class="pre">postgresql://&lt;server&gt;[:&lt;port&gt;]/&lt;database&gt;[/&lt;schema&gt;]/&lt;reponame&gt;?user=&lt;username&gt;&amp;password=&lt;pwd&gt;</span></code></p>
<p>In the above URI scheme, parts enclosed between <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code> symbols are mandatory, and parts enclosed between <code class="docutils literal notranslate"><span class="pre">[]</span></code> symbols are optional. These symbols do not have to be written as part of the actual URI.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;server&gt;</span></code>: The PostgreSQL server host or IP address</li>
<li><code class="docutils literal notranslate"><span class="pre">[:port]</span></code>: The TCP port number the server is listening to for connections. Defaults to <code class="docutils literal notranslate"><span class="pre">5432</span></code> if not provided.</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;database&gt;</span></code>: The name of the database in the server where GeoGig will store the repositories</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;schema&gt;</span></code>: The PostgreSQL database schema, defaults to <code class="docutils literal notranslate"><span class="pre">public</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;reponame</span></code>: The name of the GeoGig repository to create</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;username&gt;</span></code>: The PostgreSQL user name to connect as</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;pwd&gt;</span></code>: The PostgreSQL user’s password to connect with</li>
</ul>
<p>Examples:</p>
<p>The following commands create two repositories, <code class="docutils literal notranslate"><span class="pre">gold</span></code> and <code class="docutils literal notranslate"><span class="pre">QA</span></code> in the same <code class="docutils literal notranslate"><span class="pre">geogig</span></code> database of the <code class="docutils literal notranslate"><span class="pre">dbserver</span></code> PostgreSQL instance:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@localhost:/home/user$</span> geogig --repo <span class="s2">&quot;postgresql://dbserver/geogig/master/gold?user=peter&amp;password=secret&quot;</span> init

<span class="gp">user@localhost:/home/user$</span> geogig --repo <span class="s2">&quot;postgresql://dbserver/geogig/master/QA?user=peter&amp;password=secret&quot;</span> init
</pre></div>
</div>
<p>Tired already of typing the repository URI?
A nice trick is to use environment variables instead:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@localhost:/home/user$</span> <span class="nb">export</span> <span class="nv">gold</span><span class="o">=</span><span class="s2">&quot;postgresql://dbserver/geogig/master/gold?user=peter&amp;password=secret&quot;</span>
<span class="gp">user@localhost:/home/user$</span> <span class="nb">export</span> <span class="nv">QA</span><span class="o">=</span><span class="s2">&quot;postgresql://dbserver/geogig/master/QA?user=peter&amp;password=secret&quot;</span>

<span class="gp">user@localhost:/home/user$</span> geogig --repo <span class="nv">$gold</span> init
<span class="gp">user@localhost:/home/user$</span> geogig --repo <span class="nv">$QA</span> init
</pre></div>
</div>
</div>
<div class="section" id="performance-tuning">
<span id="postgres-performance-tuning"></span><h2>Performance Tuning<a class="headerlink" href="#performance-tuning" title="Permalink to this headline">¶</a></h2>
<p>There are several configuration options for tuning the cacheing and threading of the PostgreSQL backend.  The following configuration options should be set in the global config of the database.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">postgres.maxConnections</span></code>: The maximum number of simultaneous idle and in-use connections to the database. Defaults to 10.</li>
<li><code class="docutils literal notranslate"><span class="pre">postgres.threadPoolSize</span></code>: The number of threads that the object database should use.  Defaults to the number of processors available to the virtual machine, or 2, whichever is higher.</li>
<li>Caching: refer to the <a class="reference internal" href="../start/runtime.html#runtime-config"><span class="std std-ref">Runtime configuration</span></a> section for more information</li>
</ul>
<p>Additionally, each repository can be tuned by adjusting the batch size of <code class="docutils literal notranslate"><span class="pre">GET</span></code> and <code class="docutils literal notranslate"><span class="pre">PUT</span></code> requests by adjusting the following configuration options.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">postgres.getAllBatchSize</span></code>: The maximum number of objects to retrieve from the database in a single request. If the number of objects that need to be fetched exceed the batch size, the job will be split into multiple tasks that can be run on multiple threads, if they are available.</li>
<li><code class="docutils literal notranslate"><span class="pre">postgres.putAllBatchSize</span></code>: The maximum number of objects to insert into the database in a single request. If the number of objects that need to be inserted exceed the batch size, the job will be split into multiple tasks that can be run on multiple threads, if they are available.</li>
</ul>
</div>
<div class="section" id="database-set-up">
<h2>Database set up<a class="headerlink" href="#database-set-up" title="Permalink to this headline">¶</a></h2>
<p>GeoGig will create the necessary tables the first time it’s used against a given database.
For example, if you start with an empty databse and create a new repository on it, GeoGig will detect the missing tables and create them, like in the following example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> su - postgres -c <span class="s2">&quot;create database geogig_tests&quot;</span>
<span class="gp">$</span> geogig init <span class="s2">&quot;postgresql://localhost/geogig_tests/myrepo?user=postgres&amp;password=postgres&quot;</span>
<span class="go">Initialized empty Geogig repository in postgresql://localhost/geogig_tests/myrepo?user=postgres&amp;password=postgres</span>
</pre></div>
</div>
<p>However, the database and user/role must already exist in PostgreSQL. You can use a pre-existing PostgreSQL role with administrative access to an existing database or you can run the following steps and SQL script to create the GeoGig database and tables first.</p>
<p><a class="reference download internal" href="../_downloads/geogig_postgres.sql" download=""><code class="xref download docutils literal notranslate"><span class="pre">geogig_postgres.sql</span></code></a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">user@localhost:/home/user$</span> su - postgres
<span class="gp">postgres@localhost: $</span> createdb geogig
<span class="gp">postgres@localhost: $</span> psql -d geogig -f geogig_postgres.sql
</pre></div>
</div>
<p>Finally, refer to the <a class="reference internal" href="../interaction/geoserver_ui.html#create-new-postgres-repo"><span class="std std-ref">PostgreSQL-backed GeoGig repository</span></a> to learn how to configure a repository in GeoServer.</p>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="elements.html" title="previous chapter">Repository elements</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="init.html" title="next chapter">Initializing a repository</a></div>
      </div>
      <p class="centered-text"><a href="#top"><img src="../_static/arrow_up.png" alt="back to top"/></a></p>
      </div><!-- /#content> -->
  <div id="sidebar" class="sidebar-offcanvas contrast col-sm-4 sidebar-offcanvas" id="sidebar" role="navigation">

    <div>
         <form id="quick-search" action="search.html" method="get" style="width: 100%;">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
          </fieldset>
        </form>


        <div class="btn-group-vertical" id="docs_toc">
          <a class="btn btn-default" href="/docs/">User Manual</a>
          <a class="btn btn-default" href="/technical/">Technical Manual</a>
          <a class="btn btn-default" href="/manpages/">Man Pages</a>
          <a class="btn btn-default" href="/workshop/">Workshop</a>
          <a class="btn btn-default" href="/upgrade/">Upgrading</a>
      </div>
      <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Storage Back-ends</a></li>
<li><a class="reference internal" href="#default-storage-backend">Default storage backend</a></li>
<li><a class="reference internal" href="#postgresql-storage-backend">PostgreSQL storage backend</a><ul>
<li><a class="reference internal" href="#postgresql-repository-uri">PostgreSQL repository URI</a></li>
<li><a class="reference internal" href="#performance-tuning">Performance Tuning</a></li>
<li><a class="reference internal" href="#database-set-up">Database set up</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section continue_reading">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="elements.html" title="previous chapter">Repository elements</a></li>
            <li>Next: <a href="init.html" title="next chapter">Initializing a repository</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="../_sources/repo/storage.rst.txt">Show Source</a></li>
        </ul>
        </div>
        <div class="section">
          <h3>License</h3>
          <p>GeoGig is published using the <a href="https://github.com/locationtech/geogig/blob/master/LICENSE.txt">Eclipse Distribution License</a> (EDL). This is an open source initiative approved BSD-3 Clause license.</p>
          
          <p>This documentation is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. Page template includes work by the JQuery Foundation (<a href="https://github.com/jquery/jquery/blob/master/LICENSE.txt">MIT License</a>).</p>
        </div>

  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div>
</div>

</div><!-- /#main -->
    <footer>
      <div class="container">
        <div class="row">
          <div class=""><p class="repo-owner"><a href="https://github.com/locationtech/geogig">GeoGig</a> available on LocationTech. Website maintained by <a href="https://github.com/boundlessgeo"><img src="../_static/Boundless_Logo.png" alt="Boundless"></a></p></div>
        </div>
      </div>
    </footer>


  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/jquery-migrate-min.js"></script>
  <script type="text/javascript" src="../_static/bootstrap.min.js" ></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/searchtools.js"></script>
  <script type="text/javascript" src="../searchindex.js"></script>
  <script>
      $(document).ready(function() {

      $('[data-toggle=offcanvas]').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
      $('.list-group-item').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
    });
  </script>
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3879903-19']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>
  </body>
</html>
