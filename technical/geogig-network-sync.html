<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  
  <title>GeoGig Network Synchronization &mdash; GeoGig 1.2 Technical Manual</title>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,800italic,300,700,600,800,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cantarell:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="_static/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="_static/print.css" type="text/css" media="print" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="_static/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/offcanvas.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <link rel="shortcut icon" href="_static/favicon.ico"/>
      <link rel="index" title="Index" href="genindex.html" />
      <link rel="search" title="Search" href="search.html" />
      <link rel="top" title="GeoGig 1.2 Technical Manual" href="index.html" />
      <link rel="next" title="Plumbing commands" href="plumbing_commands.html" />
      <link rel="prev" title="Binary encoding of GeoGig objects" href="geogig-binary.html" />
</head>
<body class="geogig-network-sync">
    <div id="blacktop"></div>
    <header id="masthead">
      <div class="navbar">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://geogig.org"><h1>GeoGig</h1></a>
          </div>
          <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
              <li><a href="http://geogig.org/#install">Get Started</a></li>
              <li><a href="http://geogig.org/docs/index.html">Documentation</a></li>
              <li><a href="https://github.com/locationtech/geogig">On Github</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </div>
    </header>

    <section class="subheading hidden-xs">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <p class="byline">A Tool for Geospatial Data Management</p>
          </div>
        </div>
      </div>
    </section>
    <a name="top"></a>

 <div id="main">
    <div class="wrap selfclear">
      <div id="content">
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
          <div class="col-md-8">
            <div class="row pull-right">
             <div class="visible-sm visible-xs" id="menu-btn">
                <button class="btn btn-blue btn-sm"type="button" data-toggle="offcanvas">
                  <span class="btn-text active">Menu &rarr;</span>
                  <span class="btn-back">&larr; Back</span>
                </button>
              </div>
            </div>
<ul id="breadcrumbs">
  
  <li><a href="index.html">GeoGig 1.2 Technical Manual</a> &raquo;</li>
  <li>GeoGig Network Synchronization</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="genindex.html" title="General Index"
       accesskey="I">index</a></li>
  <li>
    <a href="plumbing_commands.html" title="Plumbing commands"
       accesskey="N">next</a>|</li>
  <li>
    <a href="geogig-binary.html" title="Binary encoding of GeoGig objects"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="geogig-network-synchronization">
<h1>GeoGig Network Synchronization<a class="headerlink" href="#geogig-network-synchronization" title="Permalink to this headline">¶</a></h1>
<p>For synchronization over network connections, GeoGig defines a protocol layered over HTTP.
This document defines the operations the GeoGig server must provide, and the way that a GeoGig client is expected to use it to achieve synchronization.
In fact, GeoGig synchronization consists of two different types of operation - a “push” in which a client copies history to a server, and a “pull” in which a client copies history from a server.</p>
</div>
<div class="section" id="server-operations">
<h1>Server operations<a class="headerlink" href="#server-operations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="manifest">
<h2>Manifest<a class="headerlink" href="#manifest" title="Permalink to this headline">¶</a></h2>
<p>The server provides a “manifest” document advertising its named refs and their current commit ids.
Synchronization operations generally begin with the client requesting a manifest from the server in order to assess the differences between their histories.</p>
<p>The manifest resource responds to GET requests at <code class="docutils literal notranslate"><span class="pre">repo/manifest</span></code> relative to the GeoGig server and contains a line-oriented textual description of the refs.
Each ref includes its name and commit id (the commit id in hexadecimal notation); a prefix including the symbolic name for the ref may also be included.
The first line should represent the HEAD symbolic ref.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>GET /geogig/repo/manifest

HEAD /refs/branches/master 00000000000000000000
/refs/branches/master 00000000000000000000
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This doesn’t seem to account for the case where a symbolic ref does not point at a named branch/tag/whatever.
What happens in that case?</p>
</div>
</div>
</div>
<div class="section" id="existence-check">
<h2>Existence Check<a class="headerlink" href="#existence-check" title="Permalink to this headline">¶</a></h2>
<p>The server provides an existence check service to support history negotiation - this walks history backwards (from newer to older commits) and gives information about the lineage of commits that might not be present on the client.
When a client determines that it has content to send to a server or that a server has content that should be fetched, history negotiation helps to narrow down exactly the range of commits that must be transfered.</p>
<p>The existence-check resource responds to POST requests at <code class="docutils literal notranslate"><span class="pre">repo/exists</span></code>.
The request body should be a JSON document containing two fields:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">have</span></code> a list of object ids representing commits already present on the client.</dt>
<dd>When walking history, the server should consider any commits from the “have” list as stopping points - as these commits are already on the client it already understands their history.</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">want</span></code> a list of object ids representing commits whose lineage the client is trying to determine (generally these should be commits that the client does not already have!)</li>
</ul>
</div></blockquote>
<p>The server responds with a JSON document enumerating the history of the commits in the want list, or an error if the <code class="docutils literal notranslate"><span class="pre">want</span></code> list requests commits that the server does not have.
The history is represented as an <a class="reference external" href="http://en.wikipedia.org/wiki/Adjacency_list">adjacency list</a> with the commit id in a field named <code class="docutils literal notranslate"><span class="pre">id</span></code> and an array containing its parents in a field named <code class="docutils literal notranslate"><span class="pre">parents</span></code>.
The server must include information about the commits listed in the want list, but it is up to the server to determine how many further commits to include.</p>
<div class="section" id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In the following example, the “want” list conveniently contains only a single commit - which happens to be a direct descendant of the one commit in the “have” list.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>POST /geogig/repo/exists
{
  &quot;want&quot; : [ &quot;abcdefabcdefabcdef12&quot; ],
  &quot;have&quot; : [ &quot;123456567890345678ab&quot; ]
}

{
  &quot;history&quot; : [
     {
       &quot;id&quot; : &quot;abcdefabcdefabcdef12&quot;,
       &quot;parents&quot;: [&quot;123456567890345678ab&quot;]
     }
  ]
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="bulk-objects">
<h2>Bulk Objects<a class="headerlink" href="#bulk-objects" title="Permalink to this headline">¶</a></h2>
<p>The server provides a bulk objects service for fetching many objects in a single request.
This walks history forward (opposite the existence check resource!) to transfer multiple objects.
By walking history in commit order, we increase robustness - an interrupted session still has high probability of leaving the client with valid commits “connected” to the rest of its history.
A well-implemented client should then be able to resume a transfer without needing to re-fetch the already-sent objects.</p>
<p>The bulk objects service accepts POST requests at <code class="docutils literal notranslate"><span class="pre">repo/objects</span></code>.
The request body should be a JSON document containing two fields:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">have</span></code> a list of object ids representing commits already present on the client.</dt>
<dd>When walking history, the server should consider any commits from the “have” list as stopping points - as these commits are already on the client it already understands their history.</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">want</span></code> a list of object ids representing commits whose lineage the client is trying to determine (generally these should be commits that the client does not already have!)</li>
</ul>
</div></blockquote>
<p>Note that this is the same format as accepted by the existence check service.</p>
<p>The server responds by streaming history objects directly in binary format.
Specifically, a 20-byte sha1 id is sent, followed by a “raw” binary blob, followed by another 20-byte id, followed by another blob, etc.</p>
<p>While the server SHOULD optimize by avoiding sending objects that are reachable from commits in the “have” list, the client MUST be prepared to handle receiving objects that it already has locally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Perhaps this stream should include more metadata - knowing how many objects were sent or where boundaries are expected to be would probably be useful for reliability purposes.</p>
</div>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>POST /geogig/repo/objects
{
  &quot;want&quot;: [&quot;abcdefabcdefabcdef12&quot;],
  &quot;have&quot;: [&quot;123456567890345678ab&quot;]
}

&lt;20 byte id&gt;&lt;binary encoded feature&gt;&lt;20 byte id&gt;&lt;binary encoded tree&gt;&lt;20 byte id&gt;&lt;binary encoded commit&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="bulk-send">
<h2>Bulk Send<a class="headerlink" href="#bulk-send" title="Permalink to this headline">¶</a></h2>
<p>The server provides a bulk send service for uploading many objects in a single request.
As with bulk object retrieval, clients should traverse in commit order.</p>
<p>The bulk send service accepts POST requests at <code class="docutils literal notranslate"><span class="pre">repo/send-objects</span></code>.
The request body should consist of one or more 20-byte ids, each followed by a binary-encoded history object.
Note this is the same format as produced by the bulk objects resource.</p>
<p>The server responds by sending a 201 Accepted status code, or an HTTP error code as appropriate.</p>
</div>
<div class="section" id="reference-update">
<h2>Reference Update<a class="headerlink" href="#reference-update" title="Permalink to this headline">¶</a></h2>
<p>The server provides a reference update service for modifying the references on the server - adding new named references, removing them, or updating existing ones to change which commits they name.</p>
<p>The reference update service accepts POST requests at <code class="docutils literal notranslate"><span class="pre">repo/update-refs</span></code>. (NOT YET IMPLEMENTED.)
The request body should be a JSON document containing one field:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">updates</span></code> a list of JSON objects with <code class="docutils literal notranslate"><span class="pre">ref</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code>, and <code class="docutils literal notranslate"><span class="pre">from</span></code> fields identifying the ref name, new value, and old value of all refs to be updated.
If the ‘to’ field contains the special value “00000000000000000000” then the ref should be deleted.
If the ref does not already exist, the client should use the special value “00000000000000000000” for the ‘from’ field.</li>
</ul>
</div></blockquote>
<p>The server responds with a document with a similar <code class="docutils literal notranslate"><span class="pre">updates</span></code> field containing the updates that were executed.  Updates may be rejected for any reasons the server deems appropriate, but MUST be rejected in the following situations:</p>
<blockquote>
<div><ul class="simple">
<li>if the “from” value of an update object does not correspond to the current value of the ref at the time of update.</li>
<li>if the “to” value of the update object corresponds to an object that is not a commit</li>
<li>if the “to” value of the update object corresponds to an object that is not known to the server</li>
<li>If the “to” value of the update object corresponds to a commit whose full history and content is not known to the server.</li>
</ul>
</div></blockquote>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="geogig-binary.html" title="previous chapter">Binary encoding of GeoGig objects</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="plumbing_commands.html" title="next chapter">Plumbing commands</a></div>
      </div>
      <p class="centered-text"><a href="#top"><img src="_static/arrow_up.png" alt="back to top"/></a></p>
      </div><!-- /#content> -->
  <div id="sidebar" class="sidebar-offcanvas contrast col-sm-4 sidebar-offcanvas" id="sidebar" role="navigation">

    <div>
         <form id="quick-search" action="search.html" method="get" style="width: 100%;">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
          </fieldset>
        </form>


        <div class="btn-group-vertical" id="docs_toc">
          <a class="btn btn-default" href="/docs/">User Manual</a>
          <a class="btn btn-default" href="/technical/">Technical Manual</a>
          <a class="btn btn-default" href="/manpages/">Man Pages</a>
          <a class="btn btn-default" href="/workshop/">Workshop</a>
          <a class="btn btn-default" href="/upgrade/">Upgrading</a>
      </div>
      <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">GeoGig Network Synchronization</a></li>
<li><a class="reference internal" href="#server-operations">Server operations</a><ul>
<li><a class="reference internal" href="#manifest">Manifest</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#existence-check">Existence Check</a><ul>
<li><a class="reference internal" href="#id1">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bulk-objects">Bulk Objects</a><ul>
<li><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bulk-send">Bulk Send</a></li>
<li><a class="reference internal" href="#reference-update">Reference Update</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section continue_reading">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="geogig-binary.html" title="previous chapter">Binary encoding of GeoGig objects</a></li>
            <li>Next: <a href="plumbing_commands.html" title="next chapter">Plumbing commands</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="_sources/geogig-network-sync.rst.txt">Show Source</a></li>
        </ul>
        </div>
        <div class="section">
          <h3>License</h3>
          <p>GeoGig is published using the <a href="https://github.com/locationtech/geogig/blob/master/LICENSE.txt">Eclipse Distribution License</a> (EDL). This is an open source initiative approved BSD-3 Clause license.</p>
          
          <p>This documentation is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>. Page template includes work by the JQuery Foundation (<a href="https://github.com/jquery/jquery/blob/master/LICENSE.txt">MIT License</a>).</p>
        </div>

  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div>
</div>

</div><!-- /#main -->
    <footer>
      <div class="container">
        <div class="row">
          <div class=""><p class="repo-owner"><a href="https://github.com/locationtech/geogig">GeoGig</a> available on LocationTech. Website maintained by <a href="https://github.com/boundlessgeo"><img src="_static/Boundless_Logo.png" alt="Boundless"></a></p></div>
        </div>
      </div>
    </footer>


  <script type="text/javascript" src="_static/jquery.js"></script>
  <script type="text/javascript" src="_static/jquery-migrate-min.js"></script>
  <script type="text/javascript" src="_static/bootstrap.min.js" ></script>
  <script type="text/javascript" src="_static/underscore.js"></script>
  <script type="text/javascript" src="_static/doctools.js"></script>
  <script type="text/javascript" src="_static/searchtools.js"></script>
  <script type="text/javascript" src="searchindex.js"></script>
  <script>
      $(document).ready(function() {

      $('[data-toggle=offcanvas]').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
      $('.list-group-item').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
    });
  </script>
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3879903-19']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>
  </body>
</html>
